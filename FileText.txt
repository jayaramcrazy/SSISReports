pipeline {
    agent any
    environment {
        SQLSERVER = "JAYARAM\\DEVELOPER1"
        DATABASE  = "ErrorBD"
        login = 'JaiLogin'
        pwd = 'Jayaram@300'
    }

    stages {
        stage('Checkout code from GitHub') {
            steps {
                checkout scm
            }
        }

        stage('Insert CSV into SQL Server') {
            steps {
                script {
                        def bulkInsertQuery = """
                        BULK INSERT health.population
                        FROM 'D:/SSISGitReports/reports/csvfile/*.csv'
                        WITH (
                            FIRSTROW = 2,
                            FIELDTERMINATOR = ',',
                            ROWTERMINATOR = '\\n',
                            TABLOCK
                        );
                        """
                        def escapedQuery = bulkInsertQuery.replace('"', '\\"').replace('\n', ' ')

                        echo "Executing query: ${escapedQuery}"

                        bat """
                        sqlcmd -S ${env.SQLSERVER} -d ${env.DATABASE} -U ${env.login} -P ${env.pwd} -Q "${escapedQuery}"
                        """
                    }
                }
            }
        }
    }

