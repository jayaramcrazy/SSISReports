pipeline {
    agent any

    environment {
        SQLSERVER = 'JAYARAM\\DEVELOPER1'
        DATABASE  = 'ErrorBD'
        login     = 'JaiLogin'
        pwd       = 'Jayaram@300'
    }

    stages {
        stage('Checkout code from GitHub') {
            steps {
                checkout scm
            }
        }

        stage('Insert files into SQL Server') {
            steps {
                script {
                def bulkQuery = """
BULK INSERT health.Population
FROM 'D:\\SSISGitReport1\\csvfile\\Population.csv'
WITH (
    FIRSTROW = 2,
    FIELDTERMINATOR = ',',
    ROWTERMINATOR = '\\n',
    TABLOCK
);
"""
                            def escapedQuery = bulkQuery.replace("\n", " ").trim()
                            echo "Starting file processing"
                            bat """
                            sqlcmd -S ${env.SQLSERVER} -d ${env.DATABASE} -U ${env.login} -P "${env.pwd}" -Q "${escapedQuery}"
                            """
                        }
                    }
                }
            }
        }
    
